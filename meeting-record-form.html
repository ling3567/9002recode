<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增會議紀錄</title>
    <!-- 原本CSS保留，略 -->
    <style>
        /* 此處保留原CSS */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>新增會議紀錄</h1>
            <p>建立詳細的會議記錄，追蹤重要決策與行動項目</p>
        </div>
        <div class="form-container">
            <form id="meetingForm">
                <!-- 表單欄位，保留原本所有 input / textarea / file upload 等 -->
                <!-- 建議將你原本完整內容貼回這區塊，保留欄位名稱與名稱屬性 -->

                <!-- 表單送出按鈕 -->
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">重設</button>
                    <button type="submit" class="btn btn-primary">儲存會議紀錄</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 重設表單功能
        function resetForm() {
            if (confirm('確定要重設所有內容嗎？')) {
                document.getElementById('meetingForm').reset();
                document.getElementById('fileList').innerHTML = '';
            }
        }

        // 表單送出處理
        document.getElementById('meetingForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const meetingData = {
                meetingTitle: formData.get('meetingTitle'),
                meetingDate: formData.get('meetingDate'),
                startTime: '12:30',
                endTime: formData.get('endTime'),
                location: formData.get('location'),
                chairman: formData.get('chairman'),
                awards: formData.get('awards'),
                chairmanReport: formData.get('chairmanReport'),
                lastMeetingFollow: formData.get('lastMeetingFollow'),
                currentMeetingItems: [],
                temporaryMotion: formData.get('temporaryMotion'),
                nextMeetingFollow: formData.get('nextMeetingFollow'),
                chairmanConclusion: formData.get('chairmanConclusion'),
                attachmentLink: '',
                createdAt: new Date().toISOString()
            };

            const itemTitles = formData.getAll('itemTitle[]');
            let combinedItems = '';
            itemTitles.forEach((title, index) => {
                if (title.trim()) {
                    const subItems = formData.getAll(`subItemContent_${index}[]`);
                    const subItemText = subItems
                        .filter(item => item.trim())
                        .map((item, i) => `　${i + 1}. ${item}`)
                        .join('\n');
                    combinedItems += `【${title}】\n${subItemText}\n\n`;
                }
            });
            meetingData.currentMeetingItems = combinedItems.trim();

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwEgDDAX-2cauZlZL04vp7h698XmFgTWyXfis6JmuVIDS-MsTPTBPlXDZUZSldJACSGOQ/exec', {
                    method: 'POST',
                    body: JSON.stringify({ contents: meetingData }),
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.text();
                alert('提交成功：' + result);
                this.reset();
                document.getElementById('fileList').innerHTML = '';
            } catch (error) {
                alert('提交失敗：' + error);
                console.error(error);
            }
        });
    </script>
</body>
</html>
